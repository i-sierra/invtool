{% extends "base.html" %}
{% block content %}
<h2>{{ 'Edit part distributor' if pd else 'Add distributor to part' }}</h2>
<form method="post" action="{{ action }}">
  <div class="grid">
    <label>Distributor
      <select name="distributor_id" {% if pd %}disabled{% endif %}>
        {% for d in distributors %}
          <option value="{{ d.id }}" {% if pd and pd.distributor_id==d.id %}selected{% endif %}>
            {{ d.code }} â€” {{ d.name }}
          </option>
        {% endfor %}
      </select>
    </label>
    <label>Distributor PN
      <input name="distributor_pn" value="{{ (pd.distributor_pn if pd else '') }}">
    </label>
    <label>Preference
      <select name="preference">
        {% for val in ['preferred','alternate','not-recommended'] %}
          <option value="{{ val }}" {% if pd and pd.preference==val %}selected{% endif %}>{{ val }}</option>
        {% endfor %}
      </select>
    </label>
    <label>Note
      <input name="note" value="{{ (pd.note if pd else '') }}">
    </label>
  </div>
  <div class="actions">
    <button type="submit">Save</button>
    <a class="btn" href="/ui/parts/{{ part.id }}">Cancel</a>
  </div>
</form>

{% if pd %}
  <h3>Price breaks</h3>
  <form method="post" action="/ui/parts/{{ part.id }}/distributors/{{ pd.id }}/pricebreaks/new" class="inline">
    <input name="min_qty" type="number" min="1" placeholder="Min qty">
    <input name="unit_price" type="number" step="0.000001" min="0" placeholder="Unit price">
    <input name="currency" value="EUR" maxlength="3">
    <button type="submit">Add</button>
  </form>

  <table>
    <thead><tr><th>Min qty</th><th>Unit price</th><th>Currency</th><th></th></tr></thead>
    <tbody>
      {% for pb in pd.price_breaks|sort(attribute='min_qty') %}
        <tr>
          <td>{{ pb.min_qty }}</td>
          <td>{{ pb.unit_price }}</td>
          <td>{{ pb.currency }}</td>
          <td>
            <form method="post" action="/ui/parts/{{ part.id }}/distributors/{{ pd.id }}/pricebreaks/{{ pb.id }}/delete">
              <button type="submit">Delete</button>
            </form>
          </td>
        </tr>
      {% else %}
        <tr><td colspan="4">No price breaks.</td></tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}
{% endblock %}
