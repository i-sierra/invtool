{% extends "base.html" %}
{% block content %}
<h2>{{ 'Edit Part' if part else 'New Part' }}</h2>

{% if message %}
  <div class="alert {{ 'error' if error else 'ok' }}">{{ message }}</div>
{% endif %}

<form method="post" action="{{ action }}">
  <!-- IPN fieldset -->
  <fieldset>
    <legend>IPN</legend>
    <p><small>Leave IPN empty for automatic generation. Default suffix is <code>-00</code>. You can choose a suffix.</small></p>
    <div class="grid">
      <label>IPN<input name="ipn" placeholder="XXXXXX-XX" value="{{ (part.ipn if part else '') }}" {{ 'readonly' if part else '' }}></label>
      <label>Family base (6 digits)
        <input name="ipn_family_base" pattern="\d{6}" placeholder="XXXXXX" value="{{ (part.ipn[:6] if part else '') }}" {{ 'readonly' if part else '' }}>
      </label>
      <label>Suffix (00..99)
        <input name="ipn_suffix" type="number" min="0" max="99" value="{{ (part.ipn[-2:] if part else '0') }}" {{ 'readonly' if part else '' }}>
      </label>
    </div>
  </fieldset>
  <!-- General fieldset -->
  <fieldset class="grid">
    <legend>General</legend>
    <label>Description<input name="description" required value="{{ (part.description if part else '') }}"></label>
    <label>Manufacturer<input name="manufacturer" required value="{{ (part.manufacturer if part else '') }}"></label>
    <label>MPN<input name="manufacturer_pn" required value="{{ (part.manufacturer_pn if part else '') }}"></label>
    <label>Lifecycle
      <select name="lifecycle">
        <option value="active" {% if (part.lifecycle if part else '') == 'active' %}selected{% endif %}>Active</option>
        <option value="obsolete" {% if (part.lifecycle if part else '') == 'obsolete' %}selected{% endif %}>Obsolete</option>
        <option value="end-of-life" {% if (part.lifecycle if part else '') == 'end-of-life' %}selected{% endif %}>End of Life</option>
        <option value="not-for-new-design" {% if (part.lifecycle if part else '') == 'not-for-new-design' %}selected{% endif %}>Not for New Designs</option>
        <option value="n/a" {% if (part.lifecycle if part else '') == 'n/a' %}selected{% endif %}>N/A</option>
      </select>
    </label>
    <label>UoM<input name="uom" value="{{ (part.uom if part else 'pcs') }}"></label>
    <label>Part type
      <select name="part_type_id">
        <option value="">—</option>
        {% for t in types %}
          <option value="{{ t.id }}">{{ t.code }} — {{ t.label }}</option>
        {% endfor %}
      </select>
    </label>
    <label>Compound
      <input type="checkbox" name="is_compound" value="1" {% if part and part.is_compound %}checked{% endif %}>
    </label>
  </fieldset>
  <!-- Buttons -->
  <div class="actions">
    <button type="submit">Save</button>
    <a class="btn" href="/ui/parts">Cancel</a>
  </div>
</form>
{% endblock %}
